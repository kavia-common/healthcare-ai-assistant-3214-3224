{"is_source_file": true, "format": "Python", "description": "This file defines API endpoints related to chat functionalities within a healthcare AI assistant project. It includes route definitions for sending messages, managing chat threads, and storing and retrieving chat messages involving users and AI agents.", "external_files": ["fastapi", "sqlalchemy.orm", "./db", "./models", "./schemas", "./openai_client"], "external_methods": ["get_db_session", "models.ChatThread", "models.Patient", "models.ChatMessage", "SendChatRequest", "SendChatResponse", "ChatMessageOut", "get_dual_agent_responses"], "published": [], "classes": [{"name": "APIRouter", "description": "FastAPI router instance used to define chat-related API endpoints."}], "methods": [{"name": "models.ChatThread _ensure_thread_for_patient(db: Session, patient_id: int)", "description": "Ensures that a chat thread exists for the given patient; creates one if it doesn't exist.", "scope": "", "scopeKind": ""}, {"name": "send_chat(payload: SendChatRequest, db: Session = Depends(get_db_session))", "description": "API endpoint that handles receiving a user message, fetching AI responses, storing all messages, and returning the chat details.", "scope": "", "scopeKind": ""}], "calls": ["db.query", "models.ChatThread", "db.add", "db.flush", "db.refresh", "models.Patient", "models.ChatMessage", "get_dual_agent_responses"], "search-terms": ["routers_chat", "send_chat", "dual_agent_responses", "ChatMessage", "ChatThread", "send", "POST"], "state": 2, "file_id": 9, "knowledge_revision": 36, "git_revision": "9df9a08102a57f46a54ba61ee29c03d70d2e2223", "revision_history": [{"18": ""}, {"36": "9df9a08102a57f46a54ba61ee29c03d70d2e2223"}], "ctags": [{"_type": "tag", "name": "_ensure_thread_for_patient", "path": "/home/kavia/workspace/code-generation/healthcare-ai-assistant-3214-3224/backend/src/api/routers_chat.py", "pattern": "/^def _ensure_thread_for_patient(db: Session, patient_id: int) -> models.ChatThread:$/", "language": "Python", "typeref": "typename:models.ChatThread", "kind": "function", "signature": "(db: Session, patient_id: int)"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/healthcare-ai-assistant-3214-3224/backend/src/api/routers_chat.py", "pattern": "/^router = APIRouter(prefix=\"\\/chat\", tags=[\"Chat\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "send_chat", "path": "/home/kavia/workspace/code-generation/healthcare-ai-assistant-3214-3224/backend/src/api/routers_chat.py", "pattern": "/^async def send_chat(payload: SendChatRequest, db: Session = Depends(get_db_session)):$/", "language": "Python", "kind": "function", "signature": "(payload: SendChatRequest, db: Session = Depends(get_db_session))"}], "hash": "e070e4c82ffafeb6b94630267d1ebe7e", "format-version": 4, "code-base-name": "backend", "filename": "backend/src/api/routers_chat.py", "fields": [{"name": "router = APIRouter(prefix=\"\\/chat\", tags=[\"Chat\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}